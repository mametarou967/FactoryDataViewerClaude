# Tasklist

## Phase 1: パケットフォーマット設計
- [ ] GW→エッジ のコマンドフォーマット確定
- [ ] エッジ→GW のレスポンスフォーマット確定
- [ ] エラー応答フォーマット確定
- [ ] タイムアウト・再送ポリシー確定

## Phase 2: エッジ firmware（Pico）
- [ ] E220ドライバ実装（モード切替・送受信・AUX監視）
- [ ] ポーリング応答処理（コマンド受信 → センサー読取 → レスポンス送信）
- [ ] DIPスイッチ読取・ユニット種別判定
- [ ] パトライト監視統合（既存 Tca9548aDlightApplication を組込み）
- [ ] 電流監視統合（既存 RasberryPiPicoSpiCurrentMcuApplication を組込み・RMS計算追加）
- [ ] SSD1306表示ドライバ（Wire1使用）
- [ ] ボタン入力処理（デバウンス含む）
- [ ] 設定UI（液晶+3ボタンによるメニュー）
- [ ] E220設定の読み書き（設定値をFlashに保存）
- [ ] LoRa経由リモート設定
- [ ] USBシリアル経由設定
- [ ] ローカルテストモード（センサー値・波形表示）
- [ ] 設定確認画面

## Phase 3: GW software（Raspberry Pi 5 / Python）
- [ ] GW設定ファイル設計・実装（YAML）
- [ ] E220制御ドライバ（USB serial）
- [ ] ポーリングマスター実装（全ユニット順次問い合わせ、1分周期）
- [ ] タイムアウト・再送処理
- [ ] データ統合（patlite + current → 1レコード）
- [ ] CSV書き込み（機械ごとサブディレクトリ）
- [ ] lora_logger.py の再実装

## Phase 4: Webアプリ（Flask）
- [ ] 11台対応のデータ読み取り構造に変更
- [ ] 現在状態一覧画面（11台）
- [ ] 状態判定ロジックを設定ファイルベースに変更
- [ ] 既存の日別・月別グラフ機能を多機械対応に拡張
- [ ] app.py の再実装

## Phase 5: OTA（任意・最後）
- [ ] ブートローダー設計（新ファームをFlashに書込み・検証・切替）
- [ ] GW側OTA配信ロジック
- [ ] パケット分割・CRC検証・再送制御
- [ ] ロールバック機能

## 完了済み
- [x] ハードウェア設計（KiCadスケマティック）
- [x] ピンアサイン確定
- [x] センサー読み取りコード（輝度・電流）
- [x] GWプロトタイプ動作確認
- [x] システム仕様確定
- [x] gitリポジトリ初期化
